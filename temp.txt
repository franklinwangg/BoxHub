app.post("/api/posts/createPost", imageUpload.single("image"), async (req, res) => {
    // 1) insert title into postgresql database, get the postId number

    const title = req.body.title;
    const content = req.body.content;
    const image = req.file;

    const insertResult = await client.query("INSERT INTO posts(title) VALUES ($1) RETURNING id", [title]);
    const postId = insertResult.rows[0].id;

    // 2) Insert the image URL (from S3) into PostgreSQL
    const imageUrl = image.location;  // S3 URL of the uploaded image
    await client.query(
        "UPDATE posts SET image_url = $1 WHERE id = $2",
        [imageUrl, postId]
    );

    // 2) insert article into S3 with the postId number, get the url
    const articleBucketName = "boxhub-articles";

    const articleData = {
        content: content,
        postId: postId,
    }

    const articleParams = {
        Bucket: articleBucketName,
        Key: `${postId}.json`,
        ACL: 'bucket-owner-full-control', // Grants full control to the bucket owner
        Body: JSON.stringify(articleData),
        ContentType: "application/json"
    };

    // const articleS3Response = await s3.upload(articleParams).promise();
    const articleS3Response = await s3.send(new PutObjectCommand(articleParams));

    // 3) insert article url into postgresql database
    await client.query("UPDATE posts SET article_url = $1 WHERE id = $2", [articleS3Response.Location, postId]);

});
